@import 'tailwindcss';

@source '../node_modules/streamdown/dist/*.js';

@layer base {
  :root {
    /* Enhanced color palette with better contrast and accessibility */
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 25 95% 53%;
    --primary-foreground: 0 0% 100%;
    --primary-light: 25 95% 70%;
    --secondary: 210 40% 96%;
    --secondary-foreground: 222.2 84% 4.9%;
    --muted: 210 40% 96%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96%;
    --accent-foreground: 222.2 84% 4.9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 25 95% 53%;
    --radius: 0.5rem;
    /* subtle code block background variable (light/dark aware) */
    --prose-code-bg: rgba(0, 0, 0, 0.04);
    --prose-code-label-bg: rgba(0, 0, 0, 0.06);
    --text-primary: 222.2 84% 4.9%;
    --text-secondary: 215.4 16.3% 46.9%;
    --text-tertiary: 215.4 16.3% 46.9%;
    --text-accent: 25 95% 53%;
  }

  .dark {
    --background: 0 0% 12.9%;
    --foreground: 0 0% 100%;
    --card: 0 0% 25.5%;
    --card-foreground: 0 0% 100%;
    --popover: 0 0% 25.5%;
    --popover-foreground: 0 0% 100%;
    --primary: 25 95% 53%;
    --primary-foreground: 0 0% 100%;
    --primary-light: 25 95% 70%;
    --secondary: 0 0% 30%;
    --secondary-foreground: 0 0% 100%;
    --muted: 0 0% 30%;
    --muted-foreground: 0 0% 69%;
    --accent: 25 95% 53%;
    --accent-foreground: 0 0% 100%;
    --destructive: 0 75% 18%;
    --destructive-foreground: 0 0% 100%;
    --border: 0 0% 100% / 0.15;
    --input: 0 0% 30%;
    --ring: 25 95% 53%;
    --prose-code-bg: rgba(255, 255, 255, 0.03);
    --prose-code-label-bg: rgba(255, 255, 255, 0.04);

    /* Custom dark mode palette */
    --bg-primary: #212121;
    --bg-primary-inverted: #fff;
    --bg-secondary: #303030;
    --bg-tertiary: #414141;
    --bg-tertiary-rgb: 65, 65, 65;
    --bg-scrim: #0d0d0d80;
    --bg-elevated-primary: #303030;
    --bg-tertiary-rgb: 65, 65, 65;
    --bg-elevated-secondary: #181818;
    --bg-accent-static: #0285ff;
    --bg-status-warning: #4a2206;
    --bg-status-error: #4d100e;
    --border-default: #ffffff26;
    --border-heavy: #fff3;
    --border-light: #ffffff0d;
    --border-status-warning: #4a2206;
    --border-status-error: #4d100e;
    --text-primary: #fff;
    --text-secondary: #f3f3f3;
    --text-tertiary: #afafaf;
    --text-inverted: #0d0d0d;
    --text-inverted-static: #fff;
    --text-accent: #66b5ff;
    --text-status-warning: #ff9e6c;
    --text-status-error: #ff8583;
    --icon-primary: #e8e8e8;
    --icon-secondary: #cdcdcd;
    --icon-tertiary: #afafaf;
    --icon-inverted: #0d0d0d;
    --icon-inverted-static: #fff;
    --icon-accent: #66b5ff;
    --icon-status-warning: #ff9e6c;
    --icon-status-error: #ff8583;
    --interactive-bg-primary-default: #fff;
    --interactive-bg-primary-hover: #fffc;
    --interactive-bg-primary-press: #ffffffe5;
    --interactive-bg-primary-inactive: #fff;
    --interactive-bg-primary-selected: #fff;
    --interactive-bg-secondary-default: #fff0;
    --interactive-bg-secondary-hover: #ffffff1a;
    --interactive-bg-secondary-press: #ffffff0d;
    --interactive-bg-secondary-inactive: #fff0;
    --interactive-bg-secondary-selected: #ffffff1a;
    --interactive-bg-tertiary-default: #212121;
    --interactive-bg-tertiary-hover: #181818;
    --interactive-bg-tertiary-press: #0d0d0d;
    --interactive-bg-tertiary-inactive: #212121;
    --interactive-bg-tertiary-selected: #212121;
    --interactive-bg-accent-default: #013566;
    --interactive-bg-accent-hover: #003f7a;
    --interactive-bg-accent-muted-hover: #394a5b;
    --interactive-bg-accent-muted-context: #394a5b80;
  }

  * {
    border-color: hsl(var(--border));
  }

  body {
    @apply antialiased;
    font-feature-settings:
      'rlig' 1,
      'calt' 1;
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
  }

  /* Improved scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background-color: hsl(var(--muted));
  }

  ::-webkit-scrollbar-thumb {
    background-color: hsl(var(--muted-foreground));
    border-radius: 3px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: hsl(var(--foreground));
  }

  /* Fix list styling for proper markers display */
  ul {
    list-style-type: disc;
    padding-left: 1.5rem;
  }

  ol {
    list-style-type: decimal;
    padding-left: 1.5rem;
  }

  li {
    display: list-item;
  }

  ul ul {
    list-style-type: circle;
  }

  ul ul ul {
    list-style-type: square;
  }

  ol ol {
    list-style-type: lower-alpha;
  }

  ol ol ol {
    list-style-type: lower-roman;
  }
}

@layer components {
  /* Glass morphism utilities */
  .glass {
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.18);
  }

  .glass-dark {
    background: rgba(0, 0, 0, 0.25);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.18);
  }

  /* Gradient text */
  .gradient-text {
    background: linear-gradient(
      135deg,
      hsl(var(--primary)),
      hsl(var(--primary-foreground))
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Subtle animations */
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }

  .animate-slide-up {
    animation: slideUp 0.3s ease-out;
  }

  .animate-pulse-subtle {
    animation: pulseSubtle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* Focus styles */
  .focus-ring {
    @apply focus:ring-2 focus:ring-offset-2 focus:outline-none;
  }

  /* Modern card styles */
  .card-modern {
    @apply rounded-2xl border border-slate-200/50 bg-white/80 shadow-lg backdrop-blur-sm transition-all duration-300 hover:shadow-xl;
  }

  .card-glass {
    @apply rounded-2xl border border-white/30 bg-white/60 shadow-xl backdrop-blur-lg;
  }

  /* File preview backgrounds - lighter variant for user uploads */
  .file-preview {
    border-radius: 1rem;
    border: 1px solid var(--border-default, rgba(255, 255, 255, 0.08));
    background-color: var(--card);
  }

  .file-preview-user {
    /* Match the bubble hue but render it lighter using alpha on the same RGB color */
    background-color: rgba(var(--bg-tertiary-rgb), 0.22);
    border: 1px solid rgba(var(--bg-tertiary-rgb), 0.32);
    box-shadow:
      0 6px 14px rgba(0, 0, 0, 0.16),
      inset 0 1px 0 rgba(255, 255, 255, 0.02);
    color: var(--text-inverted-static, #000);
  }

  /* Button styles */
  .btn-primary {
    @apply rounded-xl bg-linear-to-r from-amber-500 to-amber-600 px-6 py-3 font-medium text-white shadow-lg transition-all duration-300 hover:from-amber-600 hover:to-amber-700 hover:shadow-xl;
  }

  .btn-secondary {
    @apply rounded-xl bg-slate-100 px-6 py-3 font-medium text-slate-700 transition-all duration-300 hover:bg-slate-200;
  }

  .btn-ghost {
    @apply rounded-xl bg-transparent px-6 py-3 font-medium text-slate-600 transition-all duration-300 hover:bg-slate-100 hover:text-slate-700;
  }

  /* Runtime fallback utilities for the CSS variable driven primary color.
     These ensure components render the primary color even if Tailwind wasn't
     regenerated yet or production classes are missing. They respect Tailwind
     opacity helpers (e.g. bg-opacity, border-opacity, text-opacity).
  */
  .bg-primary {
    --tw-bg-opacity: 1;
    background-color: hsl(var(--primary) / var(--tw-bg-opacity));
  }

  .text-primary {
    --tw-text-opacity: 1;
    color: hsl(var(--primary) / var(--tw-text-opacity));
  }

  .border-primary {
    --tw-border-opacity: 1;
    border-color: hsl(var(--primary) / var(--tw-border-opacity));
  }

  /* helper classes to match Tailwind's opacity suffix usage when not precompiled */
  .bg-primary\/5 {
    --tw-bg-opacity: 0.05;
    background-color: hsl(var(--primary) / var(--tw-bg-opacity));
  }
  .bg-primary\/10 {
    --tw-bg-opacity: 0.1;
    background-color: hsl(var(--primary) / var(--tw-bg-opacity));
  }
  .border-primary\/30 {
    --tw-border-opacity: 0.3;
    border-color: hsl(var(--primary) / var(--tw-border-opacity));
  }
  .border-primary\/20 {
    --tw-border-opacity: 0.2;
    border-color: hsl(var(--primary) / var(--tw-border-opacity));
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulseSubtle {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.8;
  }
}

/* Markdown prose styling */
.prose {
  color: hsl(var(--foreground));
  max-width: none;
}

.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5,
.prose h6 {
  color: hsl(var(--foreground));
  font-weight: 600;
  line-height: 1.25;
}

.prose h1 {
  font-size: 2.25rem;
  margin-top: 0;
  margin-bottom: 1rem;
}

.prose h2 {
  font-size: 1.875rem;
  margin-top: 2rem;
  margin-bottom: 1rem;
}

.prose h3 {
  font-size: 1.5rem;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
}

.prose p {
  margin-bottom: 1rem;
  line-height: 1.75;
}

.prose ul,
.prose ol {
  margin-bottom: 1rem;
  padding-left: 1.5rem;
}

.prose li {
  margin-bottom: 0.25rem;
}

.prose code {
  /* Inline code should not create a large gray block */
  background-color: transparent;
  color: inherit;
  padding: 0.125rem 0.25rem;
  border-radius: 0.25rem;
  font-size: 0.875rem;
  font-weight: 500;
}

.prose pre {
  /* Remove gray panel background for code blocks; allow content to render on page background
     Syntax highlighter own styles are respected but we force transparent here to avoid a boxed look */
  background-color: transparent;
  color: inherit;
  padding: 0; /* syntax highlighter adds padding */
  border-radius: 0; /* let syntax highlighter control rounding if any */
  margin-bottom: 0.75rem;
  overflow-x: auto;
}

.prose pre code {
  background: none;
  padding: 0;
  color: inherit;
}

.prose p {
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

.prose blockquote {
  border-left: 4px solid hsl(var(--primary));
  padding-left: 1rem;
  margin-bottom: 1rem;
  color: hsl(var(--muted-foreground));
  font-style: italic;
}

.prose a {
  color: hsl(var(--primary));
  text-decoration: underline;
  font-weight: 500;
}

.prose a:hover {
  color: hsl(var(--primary-foreground));
}

.prose table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1rem;
}

.prose th,
.prose td {
  border: 1px solid hsl(var(--border));
  padding: 0.5rem;
  text-align: left;
}

.prose th {
  background-color: hsl(var(--muted));
  font-weight: 600;
}

/* Code block improvements */
.prose pre,
.prose code {
  overflow-x: auto;
  max-width: 100%;
}

.prose .not-prose {
  overflow-x: auto;
  max-width: 100%;
}

/* Code block theming helpers */
.code-block-wrapper {
  background: var(--prose-code-bg);
  border: 1px solid hsl(var(--border));
  border-radius: 0.5rem;
  overflow: visible; /* allow sticky header to escape when necessary */
}

.code-block-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0.75rem;
  border-bottom: 1px solid hsl(var(--border));
  position: sticky;
  top: 0.75rem; /* stick to viewport after scrolling */
  z-index: 40;
  backdrop-filter: blur(4px);
}

/* subtle elevation when header becomes sticky */
.code-block-header:where(:not(:root)) {
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
}

.code-block-label {
  background: var(--prose-code-label-bg);
  padding: 0.125rem 0.5rem;
  border-radius: 0.25rem;
  color: hsl(var(--muted-foreground));
  font-weight: 600;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

/* Smooth scrollbar for code blocks */
.prose pre::-webkit-scrollbar,
.prose code::-webkit-scrollbar,
.not-prose::-webkit-scrollbar {
  height: 8px;
  background: transparent;
}

.prose pre::-webkit-scrollbar-thumb,
.prose code::-webkit-scrollbar-thumb,
.not-prose::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
}

.dark .prose pre::-webkit-scrollbar-thumb,
.dark .prose code::-webkit-scrollbar-thumb,
.dark .not-prose::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
}

.prose pre::-webkit-scrollbar-thumb:hover,
.prose code::-webkit-scrollbar-thumb:hover,
.not-prose::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.3);
}

.dark .prose pre::-webkit-scrollbar-thumb:hover,
.dark .prose code::-webkit-scrollbar-thumb:hover,
.dark .not-prose::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* ThinkingDisplay Component Styles */
.thinking-display {
  border: 1px solid hsl(var(--border));
  border-radius: 8px;
  margin: 16px 0;
  background: hsl(var(--card));
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.thinking-display:hover {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.thinking-header {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  padding: 12px 16px;
  border: none;
  background: transparent;
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  font-weight: 500;
  color: hsl(var(--foreground));
  text-align: left;
  transition: background-color 0.2s;
}

.thinking-header:hover {
  background-color: hsl(var(--muted));
}

.thinking-header:focus {
  outline: 2px solid hsl(var(--ring));
  outline-offset: -2px;
}

.thinking-indicator {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pulse-dots {
  animation: pulse 1.5s ease-in-out infinite;
  color: hsl(var(--primary));
  font-size: 16px;
  letter-spacing: 2px;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 0.3;
  }
  50% {
    opacity: 1;
  }
}

.check-mark {
  color: #4caf50;
  font-size: 18px;
}

.thinking-label {
  flex: 1;
  color: hsl(var(--muted-foreground));
}

.thinking-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: auto;
}

.step-count {
  font-size: 12px;
  color: hsl(var(--muted-foreground));
  padding: 2px 8px;
  background: hsl(var(--muted));
  border-radius: 12px;
}

.complexity-badge {
  font-size: 11px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.complexity-badge[data-complexity='simple'] {
  background: #e3f2fd;
  color: #1976d2;
}

.complexity-badge[data-complexity='moderate'] {
  background: #fff3e0;
  color: #f57c00;
}

.complexity-badge[data-complexity='complex'] {
  background: #fce4ec;
  color: #c2185b;
}

.chevron {
  flex-shrink: 0;
  font-size: 10px;
  color: hsl(var(--muted-foreground));
  transition: transform 0.3s ease;
}

.chevron.expanded {
  transform: rotate(180deg);
}

.thinking-content {
  border-top: 1px solid hsl(var(--border));
  padding: 16px;
  overflow-y: auto;
  max-height: 400px;
}

.thinking-content::-webkit-scrollbar {
  width: 8px;
}

.thinking-content::-webkit-scrollbar-track {
  background: hsl(var(--muted));
  border-radius: 4px;
}

.thinking-content::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
}

.thinking-content::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

.thinking-steps {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.thinking-step {
  display: grid;
  grid-template-columns: 32px auto 1fr;
  gap: 8px;
  align-items: start;
  padding: 8px;
  border-radius: 6px;
  background: hsl(var(--muted) / 0.5);
  transition: background-color 0.2s;
}

.thinking-step:hover {
  background: hsl(var(--muted));
}

.thinking-step.streaming {
  background: #e3f2fd;
}

.dark .thinking-step.streaming {
  background: rgba(33, 150, 243, 0.1);
}

.step-icon {
  font-size: 18px;
  text-align: center;
}

.step-number {
  font-size: 11px;
  font-weight: 600;
  color: hsl(var(--muted-foreground));
  white-space: nowrap;
  padding-top: 2px;
}

.step-text {
  color: hsl(var(--foreground));
  line-height: 1.5;
  word-wrap: break-word;
}

.cursor {
  display: inline-block;
  animation: blink 1s step-end infinite;
  color: hsl(var(--primary));
  font-weight: bold;
}

@keyframes blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
}

.thinking-footer {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid hsl(var(--border));
}

.thinking-explanation {
  font-size: 13px;
  color: hsl(var(--muted-foreground));
  line-height: 1.6;
  margin: 0;
}

.thinking-explanation strong {
  color: hsl(var(--foreground));
}

.thinking-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  background: hsl(var(--muted));
  border: 1px solid hsl(var(--border));
  border-radius: 16px;
  font-size: 12px;
  color: hsl(var(--muted-foreground));
  cursor: pointer;
  transition: all 0.2s;
}

.thinking-badge:hover {
  background: hsl(var(--muted) / 0.8);
  border-color: hsl(var(--border) / 0.8);
}

.thinking-badge:focus {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}

.badge-icon {
  font-size: 14px;
}

.badge-duration {
  color: hsl(var(--muted-foreground) / 0.7);
  font-size: 11px;
}

/* Responsive design for thinking display */
@media (max-width: 768px) {
  .thinking-display {
    margin: 12px 0;
  }

  .thinking-header {
    padding: 10px 12px;
    font-size: 13px;
  }

  .thinking-content {
    padding: 12px;
    max-height: 300px;
  }

  .thinking-meta {
    flex-wrap: wrap;
  }

  .step-count,
  .complexity-badge {
    font-size: 11px;
    padding: 2px 6px;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .thinking-display {
    border-width: 2px;
  }

  .thinking-step {
    border: 1px solid hsl(var(--border));
  }

  .complexity-badge {
    border: 1px solid currentColor;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .pulse-dots,
  .cursor,
  .chevron {
    animation: none;
  }

  .thinking-header,
  .thinking-step {
    transition: none;
  }
}
